<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>≈†t√∫dium Str√°≈ænej ve≈æe ‚Äì SNV-Stred</title>

  <!-- Odkaz na jednotn√Ω ≈°t√Ωl -->
  <link rel="stylesheet" href="style.css">

  <!-- Zabezpeƒçenie -->
  <script>
    if (sessionStorage.getItem("accessGranted") !== "true") {
      window.location.href = "login.html";
    }
  </script>
</head>
<body>

  <!-- Video pozadie -->
  <video autoplay muted loop playsinline class="background">
    <source src="video/video.mp4" type="video/mp4">
    V√°≈° prehliadaƒç nepodporuje prehr√°vanie videa.
  </video>

  <!-- Navig√°cia -->
  <nav>
    <a href="index.html">Domov</a>
    <a href="zas.html">≈Ωivot a slu≈æba</a>
    <a href="study.html"><strong>≈†t√∫dium SV</strong></a>
    <a href="service.html">Slu≈æby</a>
    <a href="meet.html">Sch√¥dzky</a>
    <a href="groups.html">Skupiny</a>
  </nav>

  <!-- Obsah -->
  <div class="overlay">
    <div class="container">
      <h3>üìñ ≈†t√∫dium Str√°≈ænej ve≈æe</h3>

      <div class="filter">
        <input id="search" placeholder="Vyhƒæadaj podƒæa reƒçn√≠ka, t√©my alebo d√°tumu...">
      </div>

      <div id="study-list"></div>
    </div>
  </div>

  <!-- P√§tiƒçka -->
  <footer>¬© 2025 Zbor SNV-Stred | Intern√© pou≈æitie</footer>

  <!-- Naƒç√≠tanie √∫dajov -->
<script>
  async function loadStudyData() {
    const url = "https://docs.google.com/spreadsheets/d/1iugb5DydioZ33sLsWzfUeYkcz9a_XpVQOXNDnpcXFm4/gviz/tq?tqx=out:json&gid=1506346117";
    const container = document.getElementById("study-list");
    container.innerHTML = "<p>Naƒç√≠tavam √∫daje...</p>";

    try {
      const res = await fetch(url);
      const text = await res.text();
      const json = JSON.parse(text.substring(47).slice(0, -2));
      const rows = json.table.rows.slice(3);

      const data = rows.map(r => {
        const rawDate = r.c[0]?.f || r.c[0]?.v || "";
        const [y, m, d] = rawDate.split("-").map(Number);
        const date = !isNaN(y) ? new Date(y, m - 1, d) : null;
        return {
          date,
          dateString: rawDate,
          speaker: r.c[1]?.v || "",
          topic: r.c[2]?.v || "",
          watchtower: r.c[3]?.v || "‚Äî"
        };
      }).filter(d => d.date);

      // üîπ urƒç√≠me hranice: od nedele aktu√°lneho t√Ω≈æd≈àa do +2 mesiace
      const today = new Date();
      const currentDay = today.getDay(); // nedeƒæa = 0
      const diffToSunday = (7 - currentDay) % 7; 
      const nextSunday = new Date(today);
      nextSunday.setDate(today.getDate() + diffToSunday);

      // zaƒçiatok = nedeƒæa tohto t√Ω≈æd≈àa
      const startDate = new Date(nextSunday);
      startDate.setHours(0, 0, 0, 0);

      // koniec = o 2 mesiace nesk√¥r
      const endDate = new Date(startDate);
      endDate.setMonth(startDate.getMonth() + 2);
      endDate.setHours(23, 59, 59, 999);

      // üîπ filtrujeme podƒæa d√°tumu
      const filtered = data.filter(item => item.date >= startDate && item.date <= endDate);

      renderList(filtered);

      document.getElementById('search').addEventListener('input', e => {
        renderList(filtered, e.target.value.trim().toLowerCase());
      });

    } catch (err) {
      container.innerHTML = `<p style="color:red">Chyba pri naƒç√≠tan√≠ √∫dajov: ${err.message}</p>`;
    }
  }

  function renderList(data, filter = '') {
    const container = document.getElementById('study-list');
    container.innerHTML = '';
    data.forEach(item => {
      const text = (item.dateString + item.speaker + item.topic + item.watchtower).toLowerCase();
      if (filter && !text.includes(filter)) return;

      const week = document.createElement('div');
      week.className = 'week';
      week.innerHTML = `
        <div class="topline">
          <div class="dateTitle">${item.dateString}</div>
          <div class="meta">${item.speaker}</div>
        </div>
        <div class="time-list">
          <div class="time">${item.topic}</div>
          <div class="role">${item.watchtower}</div>
        </div>
      `;
      container.appendChild(week);
    });
    if (container.innerHTML === '') container.innerHTML = '<p>≈Ωiadne v√Ωsledky.</p>';
  }

  loadStudyData();
</script>
</body>
</html>

