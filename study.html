<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Štúdium Strážnej veže – SNV-Stred</title>

  <link rel="stylesheet" href="style.css">

  <script>
    // Overenie prístupu
    if (sessionStorage.getItem("accessGranted") !== "true") {
      window.location.href = "login.html";
    }
  </script>


  <link rel="stylesheet" href="style.css">

<div id="study-container" class="container">
  <p>Načítavam údaje...</p>
</div>

<style>
  .container {
    font-family: "Segoe UI", Roboto, sans-serif;
    max-width: 600px;
    margin: 1.5rem auto;
    padding: 0 1rem;
    color: #222;
  }

  .week {
    border: 1px solid #080805;
    border-radius: 10px;
    padding: 12px 16px;
    margin-bottom: 14px;
    background: #eef8ee;
    box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    transition: background 0.2s;
  }

  .week:hover {
    background: #add88a;
  }

  .topline {
    display: flex;
    justify-content: space-between;
    font-weight: 600;
    color: #333;
    font-size: 15px;
    margin-bottom: 6px;
  }

  .dateTitle {
    color: #555;
  }

  .meta {
    color: #12181b;
  }

  .time-list {
    display: flex;
    flex-direction: column;
    gap: 2px;
  }

  .time {
    font-size: 15px;
    color: #111;
  }

  .role {
    font-size: 14px;
    color: #000000;
  }

  p {
    text-align: center;
  }
</style>
  
  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Štúdium Strážnej veže – SNV-Stred</title>
    </a>  
<nav>
  <div class="container">
  <a href="index.html">Domov</a>|
  <a href="zas.html">Život a služba</a>|
  <a href="study.html">Štúdium SV</a>|
  <a href="service.html">Služby </a>|
  <a href="meet.html">Schôdzky</a>|
  <a href="groups.html">Skupiny</a>
</nav>
<div style="height: 15px;"></div>

  <link rel="stylesheet" href="style.css">

<script>
async function loadStudyData() {
  const url =
    "https://docs.google.com/spreadsheets/d/1iugb5DydioZ33sLsWzfUeYkcz9a_XpVQOXNDnpcXFm4/gviz/tq?tqx=out:json&gid=1506346117";
  const container = document.getElementById("study-container");
  container.innerHTML = "<p>Načítavam údaje...</p>";

  try {
    const res = await fetch(url);
    const text = await res.text();
    const json = JSON.parse(text.substring(47).slice(0, -2));
    const rows = json.table.rows.slice(3); // od 4. riadku

    const data = rows
      .map(r => {
        const rawDate = r.c[0]?.f || r.c[0]?.v || "";
        const [y, m, d] = rawDate.split("-").map(Number);
        const date = !isNaN(y) ? new Date(y, m - 1, d) : null;

        return {
          date,
          dateString: rawDate,
          speaker: r.c[1]?.v || "",
          topic: r.c[2]?.v || "",
          watchtower: r.c[3]?.v || "—"
        };
      })
      .filter(d => d.date);

    // aktuálny + budúci mesiac
    const now = new Date();
    const start = new Date(now.getFullYear(), now.getMonth(), 1);
    const end = new Date(now.getFullYear(), now.getMonth() + 2, 0);

    const upcoming = data.filter(d => d.date >= start && d.date <= end);

    if (upcoming.length === 0) {
      container.innerHTML =
        "<p>Žiadne plánované štúdiá pre aktuálny a budúci mesiac.</p>";
      return;
    }

    container.innerHTML = `
      <p><strong>Štúdiá pre ${
        now.toLocaleString("sk-SK", { month: "long" })
      } a ${
        new Date(now.getFullYear(), now.getMonth() + 1).toLocaleString("sk-SK", { month: "long" })
      } ${now.getFullYear()}</strong></p>
    `;

    upcoming.forEach(item => {
      const week = document.createElement("div");
      week.className = "week";
      week.innerHTML = `
        <div class="topline">
          <div class="dateTitle">${item.dateString}</div>
          <div class="meta">${item.speaker}</div>
        </div>
        <div class="time-list">
          <div class="time">${item.topic}</div>
          <div class="role">${item.watchtower}</div>
        </div>
      `;
      container.appendChild(week);
    });
  } catch (err) {
    container.innerHTML = `<p>Chyba pri načítaní údajov: ${err.message}</p>`;
    console.error(err);
  }
}

loadStudyData();
</script>

</body>
</html>



