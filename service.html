<!DOCTYPE html>
<html lang="sk">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Rozpis zhroma≈ædenia ‚Äî ≈Ωivot a slu≈æba</title>

<!-- Zabezpeƒçenie -->
<script>
if (sessionStorage.getItem("accessGranted") !== "true") {
  window.location.href = "login.html";
}
</script>

<style>
* { margin:0; padding:0; box-sizing:border-box; }
body, html { height:100%; width:100%; font-family:"Segoe UI", Arial, sans-serif; color:#fff; overflow-x:hidden; }

video.background { position:fixed; right:0; bottom:0; min-width:100%; min-height:100%; width:auto; height:auto; z-index:-1; filter:brightness(0.55); object-fit:cover; }

nav { position:fixed; top:0; width:100%; background: rgba(0,0,0,0.45); display:flex; justify-content:center; flex-wrap:wrap; gap:15px; padding:14px 10px; z-index:10; backdrop-filter: blur(6px); }
nav a { color:#fff; text-decoration:none; font-weight:bold; letter-spacing:0.5px; transition:0.3s; padding:6px 10px; border-radius:5px; }
nav a:hover { background: rgba(255,255,255,0.2); }

.overlay { position:relative; min-height:100%; width:100%; display:flex; flex-direction:column; align-items:center; padding:100px 20px 60px; text-align:center; }

.container{ max-width:900px; width:100%; margin:0 auto; color:#f8f3f3d3; }
.filter{ margin:20px 0; display:flex; gap:8px; justify-content:center; width:100%; }
.filter input{ flex:1; max-width:500px; padding:10px 14px; border-radius:6px; border:1px solid #d1d5db; font-size:15px; }

.week{ background: rgba(255,255,255,0.85); padding:14px; margin-bottom:20px; border-radius:10px; box-shadow:0 3px 8px rgba(0,0,0,0.25); }
.week .topline{ display:flex; justify-content:space-between; align-items:center; margin-bottom:8px; flex-wrap:wrap; gap:10px; }
.dateTitle{ font-weight:700; font-size:16px; color:#111; }
.meta{ text-align:right; font-size:14px; color:#333; }
.time-list{ display:grid; grid-template-columns: 80px 1fr 120px 150px; gap:6px 12px; align-items:start; margin-top:8px; }
.section-label{ grid-column:1 / -1; padding:8px 12px; border-radius:4px; color:#fff; font-weight:700; margin-top:10px; }
.section-label.gray{ background:#4b5563; }
.section-label.gold{ background:#b97c00; }
.section-label.maroon{ background:#701a1a; }
.time{ color:#111; font-weight:600; padding-top:6px; }
.text{ color:#111; padding-top:6px; text-align:left; }
.role{ text-align:left; color:#111; font-size:14px; padding-top:6px; font-weight:600; }
.name{ text-align:left; color:#111; padding-top:6px; }

footer { position:fixed; bottom:0; width:100%; text-align:center; font-size:0.9em; color:#ddd; background:rgba(0,0,0,0.3); padding:8px 0; }

@media(max-width:768px){
  .time-list{ grid-template-columns:80px 1fr; }
  .role{ grid-column:1 / -1; text-align:left; font-size:14px; }
}
button.pdfBtn { margin:10px 0; padding:8px 12px; border:none; border-radius:5px; background:#b97c00; color:#fff; font-weight:bold; cursor:pointer; }
button.pdfBtn:hover { background:#9c6400; }
</style>
</head>
<body>

<video autoplay muted loop playsinline class="background">
  <source src="video/video.mp4" type="video/mp4">
  V√°≈° prehliadaƒç nepodporuje prehr√°vanie videa.
</video>

<nav>
  <a href="index.html">Domov</a>
  <a href="zas.html"><strong>≈Ωivot a slu≈æba</strong></a>
  <a href="study.html">≈†t√∫dium SV</a>
  <a href="service.html">Slu≈æby</a>
  <a href="meet.html">Sch√¥dzky</a>
  <a href="groups.html">Skupiny</a>
</nav>

<div class="overlay">
  <div class="container">
    <h3>üìñ Rozpis zhroma≈ædenia ‚Äî ≈Ωivot a slu≈æba</h3>
    <div class="filter">
      <input id="search" placeholder="Vyhƒæadaj podƒæa mena, t√©my alebo d√°tumu...">
    </div>
    <button class="pdfBtn" onclick="generatePDF()">üñ®Ô∏è Generova≈• PDF</button>
    <div id="weeks"></div>
  </div>
</div>

<footer>¬© 2025 Zbor SNV-Stred | Intern√© pou≈æitie</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
async function loadData(){
  try{
    const url = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRlWNH2-03UJF46Kk7VUQzk9y3GCNO9T0sgWiLUv9pP4N2vO811mFSHKuWgQVEFBEmVaeVma_D43J-4/pub?output=csv";
    Papa.parse(url, {
      download: true,
      header: true,
      skipEmptyLines: true,
      complete: function(results){
        const rawData = results.data;
        rawData.forEach(row=>{
          row._dateObj = parseDate(row.datum);
          if(row.sections){
            try{ row.sections = JSON.parse(row.sections); }catch(e){ row.sections=[]; }
          }else row.sections=[];
        });
        const dnes = new Date(); dnes.setHours(0,0,0,0);
        const filtered = rawData.filter(r=>r._dateObj>=dnes).sort((a,b)=>a._dateObj-b._dateObj);
        renderWeeks(filtered);
        document.getElementById('search').addEventListener('input', e=>{
          renderWeeks(filtered, e.target.value.trim().toLowerCase());
        });
      }
    });
  }catch(err){
    document.getElementById('weeks').innerHTML = '<p style="color:red">Chyba: '+err.message+'</p>';
  }
}

function parseDate(d){
  if(!d) return new Date(0);
  const [day, month, year] = d.split('.').map(Number);
  return new Date(year, month-1, day);
}

function renderWeeks(data, filter=''){
  const container = document.getElementById('weeks');
  container.innerHTML='';
  data.forEach(week=>{
    const w=document.createElement('div'); w.className='week';
    const topl=document.createElement('div'); topl.className='topline';
    const left=document.createElement('div'); left.className='dateTitle';
    left.innerHTML=`${formatDate(week._dateObj)} | <span class="small">${week.title_line||week.podujatie||''}</span>`;
    const meta=document.createElement('div'); meta.className='meta';
    meta.innerHTML=`<div><strong>Predsedaj√∫ci:</strong> ${week.presedajuci||''}</div>
                     <div><strong>Modlitba:</strong> ${week.modlitba||''}</div>`;
    topl.appendChild(left); topl.appendChild(meta); w.appendChild(topl);

    (week.sections||[]).forEach(section=>{
      if(section.label){
        const lbl=document.createElement('div'); lbl.className='section-label '+(section.color||'gray'); lbl.textContent=section.label;
        w.appendChild(lbl);
      }
      const list=document.createElement('div'); list.className='time-list';
      (section.items||[]).forEach(item=>{
        const itemText = ((item.time||'')+' '+(item.text||'')+' '+(item.role||'')+' '+(item.name||'')).toLowerCase();
        if(filter && !itemText.includes(filter)) return;
        const timeEl=document.createElement('div'); timeEl.className='time'; timeEl.textContent=item.time||'';
        const textEl=document.createElement('div'); textEl.className='text'; textEl.textContent=item.text||'';
        const roleEl=document.createElement('div'); roleEl.className='role'; roleEl.textContent=item.role||'';
        const nameEl=document.createElement('div'); nameEl.className='name'; nameEl.textContent=item.name||'';
        list.appendChild(timeEl); list.appendChild(textEl); list.appendChild(roleEl); list.appendChild(nameEl);
      });
      if(list.children.length>0) w.appendChild(list);
    });
    container.appendChild(w);
  });
}

function formatDate(d){ return d.toLocaleDateString('sk-SK',{ weekday:'long', year:'numeric', month:'short', day:'numeric' }); }

function generatePDF(){
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  let y = 10;
  const weeks = document.querySelectorAll('.week');
  weeks.forEach(week=>{
    const title = week.querySelector('.dateTitle').innerText;
    doc.setFontSize(12); doc.text(title, 10, y); y+=7;
    week.querySelectorAll('.time-list').forEach(list=>{
      const rows = list.children;
      for(let i=0;i<rows.length;i+=4){
        const line = `${rows[i].textContent} | ${rows[i+1].textContent} | ${rows[i+2].textContent} | ${rows[i+3].textContent}`;
        doc.text(line, 10, y); y+=6;
        if(y>280){ doc.addPage(); y=10; }
      }
    });
    y+=5;
  });
  doc.save("rozpis.pdf");
}

loadData();
</script>

</body>
</html>




